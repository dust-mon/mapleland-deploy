name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Deploy to GitHub Pages
        run: |
          # Git ì„¤ì •
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # gh-pages ë¸Œëœì¹˜ë¡œ ì „í™˜ (ì—†ìœ¼ë©´ ìƒì„±)
          git checkout gh-pages || git checkout --orphan gh-pages
          
          # main ë¸Œëœì¹˜ì—ì„œ dist í´ë” ê°€ì ¸ì˜¤ê¸°
          git checkout main -- dist/
          
          # ê¸°ì¡´ íŒŒì¼ ì œê±° (dist í´ë” ì œì™¸)
          git rm -rf --ignore-unmatch *.html *.js *.txt .nojekyll 2>/dev/null || true
          
          # dist í´ë” ë‚´ìš©ì„ ë£¨íŠ¸ë¡œ ì´ë™
          if [ -d "dist" ]; then
            mv dist/* . 2>/dev/null || true
            rm -rf dist 2>/dev/null || true
          fi
          
          # ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
          git add -A
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"
          else
            git commit -m "Deploy to GitHub Pages - $(date '+%Y-%m-%d %H:%M:%S')"
            git push origin gh-pages
          fi
      
      - name: Display deployment info
        run: |
          echo "âœ… ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ğŸŒ ì‚¬ì´íŠ¸: https://dust-mon.github.io/mapleland-deploy/"

